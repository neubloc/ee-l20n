(function(window,undefined){function define(name,payload){define.modules[name]=payload}define.modules={};define.exports={};function normalize(path){var parts=path.split("/");var normalized=[];for(var i=0;i<parts.length;i++){if(parts[i]=="."){}else if(parts[i]==".."){normalized.pop()}else{normalized.push(parts[i])}}return normalized.join("/")}function join(a,b){return a?a.trim().replace(/\/*$/,"/")+b.trim():b.trim()}function dirname(path){return path?path.split("/").slice(0,-1).join("/"):null}function req(leaf,name){name=normalize(join(dirname(leaf),name));if(name in define.exports){return define.exports[name]}if(!(name in define.modules)){throw new Error("Module not defined: "+name)}var module=define.modules[name];if(typeof module=="function"){var exports={};var reply=module(req.bind(null,name),exports,{id:name,uri:""});module=reply!==undefined?reply:exports}return define.exports[name]=module}var require=req.bind(null,null);define("l20n/html",function(require){"use strict";var DEBUG=false;var L20n=require("../l20n");var io=require("./platform/io");L20n.shims={};var reAbsolute=/^\/|:/;var rtlLocales=["ar","fa","he","ps","ur"];var whitelist={elements:["a","em","strong","small","s","cite","q","dfn","abbr","data","time","code","var","samp","kbd","sub","sup","i","b","u","mark","ruby","rt","rp","bdi","bdo","span","br","wbr"],attributes:{global:["title","aria-label","data-original-title","data-placeholder"],a:["download"],area:["download","alt"],input:["alt","placeholder"],menuitem:["label"],menu:["label"],optgroup:["label"],option:["label"],track:["label"],img:["alt"],textarea:["placeholder"],th:["abbr"]}};var templateSupported="content"in document.createElement("template");var ctx=L20n.getContext(document.location.host);bindPublicAPI(ctx);var localizeHandler;var documentLocalized=false;if(document.readyState==="complete"){window.setTimeout(bootstrap)}else{waitFor("interactive",bootstrap)}function waitFor(state,callback){if(document.readyState===state){return callback()}document.addEventListener("readystatechange",function(){if(document.readyState===state){callback()}})}function bindPublicAPI(ctx){if(DEBUG){ctx.addEventListener("error",console.error.bind(console));ctx.addEventListener("warning",console.warn.bind(console))}ctx.localizeNode=function localizeNode(node){var nodes=getNodes(node);var many=localizeHandler.extend(nodes.ids);for(var i=0;i<nodes.nodes.length;i++){translateNode(nodes.nodes[i],nodes.ids[i],many.entities[nodes.ids[i]])}};ctx.once=function once(callback){if(documentLocalized){callback()}else{var callAndRemove=function callAndRemove(){document.removeEventListener("DocumentLocalized",callAndRemove);callback()};document.addEventListener("DocumentLocalized",callAndRemove)}};document.l10n=ctx}function bootstrap(){var headNode=document.head;var data=headNode.querySelector('script[type="application/l10n-data+json"]');if(data){ctx.updateData(JSON.parse(data.textContent))}var link=headNode.querySelector('link[rel="localization"]');if(link){loadManifest(link.href);return collectNodes()}var scripts=headNode.querySelectorAll('script[type="application/l20n"]');if(scripts.length){for(var i=0;i<scripts.length;i++){if(scripts[i].hasAttribute("src")){ctx.linkResource(scripts[i].src)}else{ctx.addResource(scripts[i].textContent)}}ctx.requestLocales();return collectNodes()}console.error("L20n: No resources found. (Put them above l20n.js.)")}function loadManifest(url){io.load(url,function(err,text){var manifest=parseManifest(text,url);setupCtxFromManifest(manifest)})}function parseManifest(text,url){var manifest=JSON.parse(text);manifest.resources=manifest.resources.map(relativeToManifest.bind(this,url));return manifest}function setDocumentLanguage(loc){document.documentElement.lang=loc;document.documentElement.dir=rtlLocales.indexOf(loc)===-1?"ltr":"rtl"}function setupCtxFromManifest(manifest){ctx.registerLocales(manifest.default_locale,manifest.locales);ctx.registerLocaleNegotiator(function(available,requested,defLoc){var Intl=require("./intl").Intl;var fallbackChain=Intl.prioritizeLocales(available,requested,defLoc);setDocumentLanguage(fallbackChain[0]);return fallbackChain});var re=/{{\s*locale\s*}}/;manifest.resources.forEach(function(uri){if(re.test(uri)){ctx.linkResource(uri.replace.bind(uri,re))}else{ctx.linkResource(uri)}});ctx.requestLocales(navigator.language||navigator.browserLanguage);return manifest}function relativeToManifest(manifestUrl,url){if(reAbsolute.test(url)){return url}var dirs=manifestUrl.split("/").slice(0,-1).concat(url.split("/")).filter(function(elem){return elem!=="."});return dirs.join("/")}function fireLocalizedEvent(){var event=document.createEvent("Event");event.initEvent("DocumentLocalized",false,false);document.dispatchEvent(event)}function collectNodes(){var nodes=getNodes(document);localizeHandler=ctx.localize(nodes.ids,function localizeHandler(l10n){if(!nodes){nodes=getNodes(document)}for(var i=0;i<nodes.nodes.length;i++){translateNode(nodes.nodes[i],nodes.ids[i],l10n.entities[nodes.ids[i]])}if("locales"in l10n.reason&&l10n.reason.locales.length){setDocumentLanguage(l10n.reason.locales[0])}nodes=null;if(!documentLocalized){documentLocalized=true;fireLocalizedEvent()}})}function getNodes(node){var nodes=node.querySelectorAll("[data-l10n-id]");var ids=[];if(node.hasAttribute&&node.hasAttribute("data-l10n-id")){nodes=Array.prototype.slice.call(nodes);nodes.push(node)}for(var i=0;i<nodes.length;i++){ids.push(nodes[i].getAttribute("data-l10n-id"))}return{ids:ids,nodes:nodes}}function camelCaseToDashed(string){return string.replace(/[A-Z]/g,function(match){return"-"+match.toLowerCase()}).replace(/^-/,"")}function replaceDataAttributes(value,node){return value.replace(/\[\[(.+?)\]\]/gi,function(match,attribute){return node.dataset[attribute]||"undefined attribute "+attribute})}function translateNode(node,id,entity){if(!entity){return}if(entity.value){if(entity.value.indexOf("<")===-1&&entity.value.indexOf("&")===-1||!templateSupported&&typeof L20n.shims.getTemplate!=="function"){node.textContent=replaceDataAttributes(entity.value,node)}else{var translation=templateSupported?document.createElement("template"):L20n.shims.getTemplate();translation.innerHTML=entity.value;overlayElement(node,translation.content)}}Object.keys(entity.attributes).forEach(function(key){var attrName=camelCaseToDashed(key);if(isAttrAllowed({name:attrName},node)){node.setAttribute(attrName,replaceDataAttributes(entity.attributes[key],node))}})}function overlayElement(sourceElement,translationElement){var result=document.createDocumentFragment();var childElement;while(childElement=translationElement.childNodes[0]){translationElement.removeChild(childElement);if(childElement.nodeType===Node.TEXT_NODE){result.appendChild(childElement);continue}var sourceChild=getElementOfType(sourceElement,childElement);if(sourceChild){overlayElement(sourceChild,childElement);result.appendChild(sourceChild);continue}if(isElementAllowed(childElement)){for(var k=0,attr;attr=childElement.attributes[k];k++){if(!isAttrAllowed(attr,childElement)){childElement.removeAttribute(attr.name)}}result.appendChild(childElement);continue}var text=document.createTextNode(childElement.textContent);result.appendChild(text)}sourceElement.textContent="";sourceElement.appendChild(result);if(translationElement.attributes){for(var k=0,attr;attr=translationElement.attributes[k];k++){if(isAttrAllowed(attr,sourceElement)){sourceElement.setAttribute(attr.name,attr.value)}}}}function isElementAllowed(element){return whitelist.elements.indexOf(element.tagName.toLowerCase())!==-1}function isAttrAllowed(attr,element){var attrName=attr.name.toLowerCase();var tagName=element.tagName.toLowerCase();if(whitelist.attributes.global.indexOf(attrName)!==-1){return true}if(!whitelist.attributes[tagName]){return false}if(whitelist.attributes[tagName].indexOf(attrName)!==-1){return true}if(tagName==="input"&&attrName==="value"){var type=element.type.toLowerCase();if(type==="submit"||type==="button"||type==="reset"){return true}}return false}function getElementOfType(context,element){var index=getIndexOfType(element);var nthOfType=0;for(var i=0,child;child=context.children[i];i++){if(child.nodeType===Node.ELEMENT_NODE&&child.tagName===element.tagName){if(nthOfType===index){return child}nthOfType++}}return null}function getIndexOfType(element){var index=0;var child;while(child=element.previousElementSibling){if(child.tagName===element.tagName){index++}}return index}return L20n});define("l20n",function(require,exports){"use strict";var Context=require("./l20n/context").Context;var Parser=require("./l20n/parser").Parser;var Compiler=require("./l20n/compiler").Compiler;exports.Context=Context;exports.Parser=Parser;exports.Compiler=Compiler;exports.getContext=function L20n_getContext(id){return new Context(id)}});define("l20n/context",function(require,exports){"use strict";var EventEmitter=require("./events").EventEmitter;var Parser=require("./parser").Parser;var Compiler=require("./compiler").Compiler;var RetranslationManager=require("./retranslation").RetranslationManager;require("./platform/globals");var io=require("./platform/io");function Resource(id,parser){var self=this;this.id=id;this.resources=[];this.source=null;this.ast={type:"L20n",body:[]};this.build=build;var _imports_positions=[];var reAbsolute=/^\/|:/;function build(nesting,callback,sync){if(nesting>=7){return callback(new ContextError("Too many nested imports."))}if(self.source){return setTimeout(function(){parse()})}else{io.load(self.id,parse,sync)}function parse(err,text){if(err){return callback(err)}else if(text!==undefined){self.source=text}self.ast=parser.parse(self.source);buildImports()}function buildImports(){var imports=self.ast.body.filter(function(elem,i){if(elem.type==="ImportStatement"){_imports_positions.push(i);return true}return false});imports.forEach(function(imp){var uri=relativeToSelf(imp.uri.content);var res=new Resource(uri,parser);self.resources.push(res)});var importsToBuild=self.resources.length;if(importsToBuild===0){return callback()}self.resources.forEach(function(res){res.build(nesting+1,resourceBuilt,sync)});function resourceBuilt(err){if(err){return callback(err)}importsToBuild--;if(importsToBuild===0){flatten()}}}function flatten(){for(var i=self.resources.length-1;i>=0;i--){var pos=_imports_positions[i]||0;Array.prototype.splice.apply(self.ast.body,[pos,1].concat(self.resources[i].ast.body))}callback()}}function relativeToSelf(url){if(self.id===null||reAbsolute.test(url)){return url}var dirs=self.id.split("/").slice(0,-1).concat(url.split("/")).filter(function(elem){return elem!=="."});return dirs.join("/")}}function Locale(id,parser,compiler,emitter){this.id=id;this.resources=[];this.entries=null;this.ast={type:"L20n",body:[]};this.isReady=false;this.build=build;this.getEntry=getEntry;this.hasResource=hasResource;var self=this;function build(callback){if(!callback){var sync=true}var resourcesToBuild=self.resources.length;if(resourcesToBuild===0){throw new ContextError("Locale has no resources")}var resourcesWithErrors=0;self.resources.forEach(function(res){res.build(0,resourceBuilt,sync)});function resourceBuilt(err){if(err){resourcesWithErrors++;emitter.emit(err instanceof ContextError?"error":"warning",err)}resourcesToBuild--;if(resourcesToBuild===0){if(resourcesWithErrors===self.resources.length){emitter.emit("error",new ContextError("Locale has no valid resources"))}flatten()}}function flatten(){self.ast.body=self.resources.reduce(function(prev,curr){return prev.concat(curr.ast.body)},self.ast.body);compile()}function compile(){self.entries=compiler.compile(self.ast);self.isReady=true;if(callback){callback()}}}function getEntry(id){if(this.entries.hasOwnProperty(id)){return this.entries[id]}return undefined}function hasResource(uri){return this.resources.some(function(res){return res.id===uri})}}function Context(id){this.id=id;this.registerLocales=registerLocales;this.registerLocaleNegotiator=registerLocaleNegotiator;this.requestLocales=requestLocales;this.addResource=addResource;this.linkResource=linkResource;this.updateData=updateData;this.getSync=getSync;this.getEntitySync=getEntitySync;this.localize=localize;this.ready=ready;this.addEventListener=addEvent;this.removeEventListener=removeEvent;Object.defineProperty(this,"supportedLocales",{get:function(){return _fallbackChain.slice()},enumerable:true});var _data={};var _negotiator;var _default="i-default";var _registered=[_default];var _requested=[];var _fallbackChain=[];var _locales={};var _reslinks=[];var _isReady=false;var _isFrozen=false;var _emitter=new EventEmitter;var _parser=new Parser;var _compiler=new Compiler;var _retr=new RetranslationManager;var self=this;_parser.addEventListener("error",error);_compiler.addEventListener("error",warn);_compiler.setGlobals(_retr.globals);function extend(dst,src){Object.keys(src).forEach(function(key){if(src[key]===undefined){delete dst[key]}else if(src[key]===null||typeof src[key]!=="object"){dst[key]=src[key]}else{if(typeof dst[key]!=="object"){dst[key]={}}extend(dst[key],src[key])}})}function updateData(obj){if(!obj||typeof obj!=="object"){throw new ContextError("Context data must be a non-null object")}extend(_data,obj)}function getSync(id,data){if(!_isReady){throw new ContextError("Context not ready")}return getFromLocale.call(self,0,id,data).value}function getEntitySync(id,data){if(!_isReady){throw new ContextError("Context not ready")}return getFromLocale.call(self,0,id,data)}function localize(ids,callback){if(!callback){throw new ContextError("No callback passed")}return bindLocalize.call(self,ids,callback)}function ready(callback){if(_isReady){setTimeout(function(){callback()})}addEvent("ready",callback)}function bindLocalize(ids,callback,reason){var bound={extend:function extend(newIds){for(var i=0;i<newIds.length;i++){if(ids.indexOf(newIds[i])===-1){ids.push(newIds[i])}}if(!_isReady){return}var newMany=getMany.call(this,newIds);_retr.bindGet({id:callback,callback:bindLocalize.bind(this,ids,callback),globals:Object.keys(newMany.globalsUsed)},true);return newMany}.bind(this),stop:function stop(){_retr.unbindGet(callback)}.bind(this)};if(!_isReady){_retr.bindGet({id:callback,callback:bindLocalize.bind(this,ids,callback),globals:[]});return bound}var many=getMany.call(this,ids);var l10n={entities:many.entities,reason:reason||{locales:_fallbackChain.slice()},stop:function(){_retr.unbindGet(callback)}};_retr.bindGet({id:callback,callback:bindLocalize.bind(this,ids,callback),globals:Object.keys(many.globalsUsed)});callback(l10n);return bound}function getMany(ids){var many={entities:{},globalsUsed:{}};for(var i=0,id;id=ids[i];i++){many.entities[id]=getEntitySync.call(this,id);for(var global in many.entities[id].globals){if(many.entities[id].globals.hasOwnProperty(global)){many.globalsUsed[global]=true}}}return many}function getFromLocale(cur,id,data,prevSource){var loc=_fallbackChain[cur];if(!loc){error(new RuntimeError("Unable to get translation",id,_fallbackChain));return{value:prevSource?prevSource.source:id,attributes:{},globals:{},locale:prevSource?prevSource.loc:null}}var locale=getLocale(loc);if(!locale.isReady){locale.build(null)}var entry=locale.getEntry(id);if(entry===undefined){warn(new TranslationError("Not found",id,_fallbackChain,locale));return getFromLocale.call(this,cur+1,id,data,prevSource)}var value;try{value=entry.get(getArgs.call(this,data))}catch(e){if(e instanceof Compiler.RuntimeError){error(new TranslationError(e.message,id,_fallbackChain,locale));if(e instanceof Compiler.ValueError){var source=prevSource||{source:e.source,loc:locale.id};return getFromLocale.call(this,cur+1,id,data,source)}return getFromLocale.call(this,cur+1,id,data,prevSource)}else{throw error(e)}}value.locale=locale.id;return value}function getArgs(extra){if(!extra){return _data}var args={};extend(args,_data);extend(args,extra);return args}function addResource(text){if(_isFrozen){throw new ContextError("Context is frozen")}_reslinks.push(["text",text])}function add(text,locale){var res=new Resource(null,_parser);res.source=text;locale.resources.push(res)}function linkResource(uri){if(_isFrozen){throw new ContextError("Context is frozen")}_reslinks.push([typeof uri==="function"?"template":"uri",uri])}function link(uri,locale){if(!locale.hasResource(uri)){var res=new Resource(uri,_parser);locale.resources.push(res)}}function registerLocales(defLocale,available){if(_isFrozen){throw new ContextError("Context is frozen")}if(defLocale===undefined){return}_default=defLocale;_registered=[];if(!available){available=[]}available.push(defLocale);available.forEach(function(loc){if(typeof loc!=="string"){throw new ContextError("Language codes must be strings")}if(_registered.indexOf(loc)===-1){_registered.push(loc)}})}function registerLocaleNegotiator(negotiator){if(_isFrozen){throw new ContextError("Context is frozen")}_negotiator=negotiator}function getLocale(loc){if(_locales[loc]){return _locales[loc]}var locale=new Locale(loc,_parser,_compiler,_emitter);_locales[loc]=locale;for(var j=0;j<_reslinks.length;j++){var res=_reslinks[j];if(res[0]==="text"){add(res[1],locale)}else if(res[0]==="uri"){link(res[1],locale)}else{link(res[1](locale.id),locale)}}return locale}function requestLocales(){if(_isFrozen&&!_isReady){throw new ContextError("Context not ready")}if(_reslinks.length===0){warn(new ContextError("Context has no resources; not freezing"));return}_isFrozen=true;_requested=Array.prototype.slice.call(arguments);if(_requested.length){_requested.forEach(function(loc){if(typeof loc!=="string"){throw new ContextError("Language codes must be strings")}})}if(!_negotiator){var Intl=require("./intl").Intl;_negotiator=Intl.prioritizeLocales}var fallbackChain=_negotiator(_registered,_requested,_default,freeze);if(fallbackChain){freeze(fallbackChain)}}function freeze(fallbackChain){var locale=getLocale(fallbackChain[0]);if(locale.isReady){setReady(fallbackChain)}else{locale.build(setReady.bind(null,fallbackChain))}}function setReady(fallbackChain){_fallbackChain=fallbackChain;_isReady=true;_retr.all(_fallbackChain.slice());_emitter.emit("ready")}function addEvent(type,listener){_emitter.addEventListener(type,listener)}function removeEvent(type,listener){_emitter.removeEventListener(type,listener)}function warn(e){_emitter.emit("warning",e);return e}function error(e){_emitter.emit("error",e);return e}}Context.Error=ContextError;Context.RuntimeError=RuntimeError;Context.TranslationError=TranslationError;function ContextError(message){this.name="ContextError";this.message=message}ContextError.prototype=Object.create(Error.prototype);ContextError.prototype.constructor=ContextError;function RuntimeError(message,id,supported){ContextError.call(this,message);this.name="RuntimeError";this.entity=id;this.supportedLocales=supported.slice();this.message=id+": "+message+"; tried "+supported.join(", ")}RuntimeError.prototype=Object.create(ContextError.prototype);RuntimeError.prototype.constructor=RuntimeError;function TranslationError(message,id,supported,locale){RuntimeError.call(this,message,id,supported);this.name="TranslationError";this.locale=locale.id;this.message="["+this.locale+"] "+id+": "+message}TranslationError.prototype=Object.create(RuntimeError.prototype);TranslationError.prototype.constructor=TranslationError;exports.Context=Context});define("l20n/events",function(require,exports){"use strict";function EventEmitter(){this._listeners={}}EventEmitter.prototype.emit=function ee_emit(){var args=Array.prototype.slice.call(arguments);var type=args.shift();if(!this._listeners[type]){return false}var typeListeners=this._listeners[type].slice();for(var i=0;i<typeListeners.length;i++){typeListeners[i].apply(this,args)}return true};EventEmitter.prototype.addEventListener=function ee_add(type,listener){if(!this._listeners[type]){this._listeners[type]=[]}this._listeners[type].push(listener);return this};EventEmitter.prototype.removeEventListener=function ee_rm(type,listener){var typeListeners=this._listeners[type];if(!typeListeners){return this}var pos=typeListeners.indexOf(listener);if(pos===-1){return this}typeListeners.splice(pos,1);return this};exports.EventEmitter=EventEmitter});define("l20n/parser",function(require,exports){"use strict";var EventEmitter=require("./events").EventEmitter;function Parser(throwOnErrors){this.parse=parse;this.addEventListener=addEvent;this.removeEventListener=removeEvent;var MAX_PLACEABLES=100;var _source,_index,_length,_emitter;var getL20n;if(throwOnErrors){getL20n=getL20nPlain}else{_emitter=new EventEmitter;getL20n=getL20nWithRecover}function getComment(){_index+=2;var start=_index;var end=_source.indexOf("*/",start);if(end===-1){throw error("Comment without closing tag")}_index=end+2;return{type:"Comment",content:_source.slice(start,end)}}function getAttributes(){var attrs=[];var attr,ws1,ch;while(true){attr=getKVPWithIndex("Attribute");attr.local=attr.key.name.charAt(0)==="_";attrs.push(attr);ws1=getRequiredWS();ch=_source.charAt(_index);if(ch===">"){break}else if(!ws1){throw error('Expected ">"')}}return attrs}function getKVP(type){var key=getIdentifier();getWS();if(_source.charAt(_index)!==":"){throw error('Expected ":"')}++_index;getWS();return{type:type,key:key,value:getValue()}}function getKVPWithIndex(type){var key=getIdentifier();var index=[];if(_source.charAt(_index)==="["){++_index;getWS();index=getItemList(getExpression,"]")}getWS();if(_source.charAt(_index)!==":"){throw error('Expected ":"')}++_index;getWS();return{type:type,key:key,value:getValue(),index:index}}function getHash(){++_index;getWS();var defItem,hi,comma,hash=[];var hasDefItem=false;while(true){defItem=false;if(_source.charAt(_index)==="*"){++_index;if(hasDefItem){throw error("Default item redefinition forbidden")}defItem=true;hasDefItem=true}hi=getKVP("HashItem");hi["default"]=defItem;hash.push(hi);getWS();comma=_source.charAt(_index)===",";if(comma){++_index;getWS()}if(_source.charAt(_index)==="}"){++_index;break}if(!comma){throw error('Expected "}"')}}return{type:"Hash",content:hash}}function _unescapeString(){var ch=_source.charAt(++_index);var cc;if(ch==="u"){var ucode="";for(var i=0;i<4;i++){ch=_source[++_index];cc=ch.charCodeAt(0);if(cc>96&&cc<103||cc>64&&cc<71||cc>47&&cc<58){ucode+=ch}else{throw error("Illegal unicode escape sequence")}}return String.fromCharCode(parseInt(ucode,16))}return ch}function getComplexString(opchar,opcharLen){var body=null;var buf="";var placeables=0;var ch;_index+=opcharLen-1;var start=_index+1;walkChars:while(true){ch=_source.charAt(++_index);switch(ch){case"\\":buf+=_unescapeString();break;case"{":if(_source.charAt(_index+1)==="{"){if(body===null){body=[]}if(placeables>MAX_PLACEABLES-1){throw error("Too many placeables, maximum allowed is "+MAX_PLACEABLES)}if(buf){body.push({type:"String",content:buf})}_index+=2;getWS();body.push(getExpression());getWS();if(_source.charAt(_index)!=="}"||_source.charAt(_index+1)!=="}"){throw error('Expected "}}"')}_index+=1;placeables++;buf="";break}default:if(opcharLen===1){if(ch===opchar){_index++;break walkChars}}else{if(ch===opchar[0]&&_source.charAt(_index+1)===ch&&_source.charAt(_index+2)===ch){_index+=3;break walkChars}}buf+=ch;if(_index+1>=_length){throw error("Unclosed string literal")}}}if(body===null){return{type:"String",content:buf}}if(buf.length){body.push({type:"String",content:buf})}return{type:"ComplexString",content:body,source:_source.slice(start,_index-opcharLen)}}function getString(opchar,opcharLen){var opcharPos=_source.indexOf(opchar,_index+opcharLen);var placeablePos,escPos,buf;if(opcharPos===-1){throw error("Unclosed string literal")}buf=_source.slice(_index+opcharLen,opcharPos);placeablePos=buf.indexOf("{{");if(placeablePos!==-1){return getComplexString(opchar,opcharLen)}else{escPos=buf.indexOf("\\");if(escPos!==-1){return getComplexString(opchar,opcharLen)}}_index=opcharPos+opcharLen;return{type:"String",content:buf}}function getValue(optional,ch){if(ch===undefined){ch=_source.charAt(_index)}if(ch==="'"||ch==='"'){if(ch===_source.charAt(_index+1)&&ch===_source.charAt(_index+2)){return getString(ch+ch+ch,3)}return getString(ch,1)}if(ch==="{"){return getHash()}if(!optional){throw error("Unknown value type")}return null}function getRequiredWS(){var pos=_index;var cc=_source.charCodeAt(pos);while(cc===32||cc===10||cc===9||cc===13){cc=_source.charCodeAt(++_index)}return _index!==pos}function getWS(){var cc=_source.charCodeAt(_index);while(cc===32||cc===10||cc===9||cc===13){cc=_source.charCodeAt(++_index)}}function getVariable(){++_index;return{type:"VariableExpression",id:getIdentifier()}}function getIdentifier(){var index=_index;var start=index;var source=_source;var cc=source.charCodeAt(start);if((cc<97||cc>122)&&(cc<65||cc>90)&&cc!==95){throw error("Identifier has to start with [a-zA-Z_]")}cc=source.charCodeAt(++index);while(cc>=97&&cc<=122||cc>=65&&cc<=90||cc>=48&&cc<=57||cc===95){cc=source.charCodeAt(++index)}_index=index;return{type:"Identifier",name:source.slice(start,index)}}function getImportStatement(){_index+=6;if(_source.charAt(_index)!=="("){throw error('Expected "("')}++_index;getWS();var uri=getString(_source.charAt(_index),1);getWS();if(_source.charAt(_index)!==")"){throw error('Expected ")"')}++_index;return{type:"ImportStatement",uri:uri}}function getMacro(id){if(id.name.charAt(0)==="_"){throw error('Macro ID cannot start with "_"')}++_index;var idlist=getItemList(getVariable,")");getRequiredWS();if(_source.charAt(_index)!=="{"){throw error('Expected "{"')}++_index;getWS();var exp=getExpression();getWS();if(_source.charAt(_index)!=="}"){throw error('Expected "}"')}++_index;getWS();if(_source.charCodeAt(_index)!==62){throw error('Expected ">"')}++_index;return{type:"Macro",id:id,args:idlist,expression:exp}}function getEntity(id,index){if(!getRequiredWS()){throw error("Expected white space")}var ch=_source.charAt(_index);var value=getValue(true,ch);var attrs=null;if(value===null){if(ch===">"){throw error('Expected ">"')}attrs=getAttributes()}else{var ws1=getRequiredWS();if(_source.charAt(_index)!==">"){if(!ws1){throw error('Expected ">"')}attrs=getAttributes()}}++_index;return{type:"Entity",id:id,value:value,index:index,attrs:attrs,local:id.name.charCodeAt(0)===95}}function getEntry(){var cc=_source.charCodeAt(_index);if(cc===60){++_index;var id=getIdentifier();cc=_source.charCodeAt(_index);if(cc===40){return getMacro(id)}if(cc===91){++_index;return getEntity(id,getItemList(getExpression,"]"))}return getEntity(id,null)}if(_source.charCodeAt(_index)===47&&_source.charCodeAt(_index+1)===42){return getComment()}if(_source.slice(_index,_index+6)==="import"){return getImportStatement()}throw error("Invalid entry")}function getL20nWithRecover(){var entries=[];getWS();while(_index<_length){try{entries.push(getEntry())}catch(e){if(e instanceof ParserError){_emitter.emit("error",e);entries.push(recover())}else{throw e}}if(_index<_length){getWS()}}return{type:"L20n",body:entries}}function getL20nPlain(){var entries=[];getWS();while(_index<_length){entries.push(getEntry());if(_index<_length){getWS()}}return{type:"L20n",body:entries}}function parse(string){_source=string;_index=0;_length=_source.length;return getL20n()}function addEvent(type,listener){if(!_emitter){throw new Error("Emitter not available")}return _emitter.addEventListener(type,listener)}function removeEvent(type,listener){if(!_emitter){throw new Error("Emitter not available")}return _emitter.removeEventListener(type,listener)}function getExpression(){return getConditionalExpression()}function getPrefixExpression(token,cl,op,nxt){var exp=nxt();var t,ch;while(true){t="";getWS();ch=_source.charAt(_index);if(token[0].indexOf(ch)===-1){break}t+=ch;++_index;if(token.length>1){ch=_source.charAt(_index);if(token[1]===ch){++_index;t+=ch}else if(token[2]){--_index;return exp}}getWS();exp={type:cl,operator:{type:op,token:t},left:exp,right:nxt()}}return exp}function getPostfixExpression(token,cl,op,nxt){var cc=_source.charCodeAt(_index);if(token.indexOf(cc)===-1){return nxt()}++_index;getWS();return{type:cl,operator:{type:op,token:String.fromCharCode(cc)},argument:getPostfixExpression(token,cl,op,nxt)}}function getConditionalExpression(){var exp=getOrExpression();getWS();if(_source.charCodeAt(_index)!==63){return exp}++_index;getWS();var consequent=getExpression();getWS();if(_source.charCodeAt(_index)!==58){throw error('Expected ":"')}++_index;getWS();return{type:"ConditionalExpression",test:exp,consequent:consequent,alternate:getExpression()}}function getOrExpression(){return getPrefixExpression([["|"],"|",true],"LogicalExpression","LogicalOperator",getAndExpression)}function getAndExpression(){return getPrefixExpression([["&"],"&",true],"LogicalExpression","Logicalperator",getEqualityExpression)}function getEqualityExpression(){return getPrefixExpression([["=","!"],"=",true],"BinaryExpression","BinaryOperator",getRelationalExpression)}function getRelationalExpression(){return getPrefixExpression([["<",">"],"=",false],"BinaryExpression","BinaryOperator",getAdditiveExpression)}function getAdditiveExpression(){return getPrefixExpression([["+","-"]],"BinaryExpression","BinaryOperator",getModuloExpression)}function getModuloExpression(){return getPrefixExpression([["%"]],"BinaryExpression","BinaryOperator",getMultiplicativeExpression)}function getMultiplicativeExpression(){return getPrefixExpression([["*"]],"BinaryExpression","BinaryOperator",getDividiveExpression)}function getDividiveExpression(){return getPrefixExpression([["/"]],"BinaryExpression","BinaryOperator",getUnaryExpression)}function getUnaryExpression(){return getPostfixExpression([43,45,33],"UnaryExpression","UnaryOperator",getMemberExpression)}function getCallExpression(callee){getWS();return{type:"CallExpression",callee:callee,arguments:getItemList(getExpression,")")}}function getAttributeExpression(idref,computed){if(idref.type!=="ParenthesisExpression"&&idref.type!=="Identifier"&&idref.type!=="ThisExpression"){throw error("AttributeExpression must have Identifier, This or "+"Parenthesis as left node")}var exp;if(computed){getWS();exp=getExpression();getWS();if(_source.charAt(_index)!=="]"){throw error('Expected "]"')}++_index;return{type:"AttributeExpression",expression:idref,attribute:exp,computed:true}}exp=getIdentifier();return{type:"AttributeExpression",expression:idref,attribute:exp,computed:false}}function getPropertyExpression(idref,computed){var exp;if(computed){getWS();exp=getExpression();getWS();if(_source.charAt(_index)!=="]"){throw error('Expected "]"')}++_index;return{type:"PropertyExpression",expression:idref,property:exp,computed:true}}exp=getIdentifier();return{type:"PropertyExpression",expression:idref,property:exp,computed:false}}function getMemberExpression(){var exp=getParenthesisExpression();var cc;while(true){cc=_source.charCodeAt(_index);if(cc===46||cc===91){++_index;exp=getPropertyExpression(exp,cc===91)}else if(cc===58&&_source.charCodeAt(_index+1)===58){_index+=2;if(_source.charCodeAt(_index)===91){++_index;exp=getAttributeExpression(exp,true)}else{exp=getAttributeExpression(exp,false)}}else if(cc===40){++_index;exp=getCallExpression(exp)}else{break}}return exp}function getParenthesisExpression(){if(_source.charCodeAt(_index)===40){++_index;getWS();var pexp={type:"ParenthesisExpression",expression:getExpression()};getWS();if(_source.charCodeAt(_index)!==41){throw error('Expected ")"')}++_index;return pexp}return getPrimaryExpression()}function getPrimaryExpression(){var pos=_index;var cc=_source.charCodeAt(pos);while(cc>47&&cc<58){cc=_source.charCodeAt(++pos)}if(pos>_index){var start=_index;_index=pos;return{type:"Number",value:parseInt(_source.slice(start,pos),10)}}switch(cc){case 39:case 34:case 123:case 91:return getValue();case 36:return getVariable();case 64:++_index;return{type:"GlobalsExpression",id:getIdentifier()};case 126:++_index;return{type:"ThisExpression"};default:return getIdentifier()}}function getItemList(callback,closeChar){var ch;getWS();if(_source.charAt(_index)===closeChar){++_index;return[]}var items=[];while(true){items.push(callback());getWS();ch=_source.charAt(_index);if(ch===","){++_index;getWS()}else if(ch===closeChar){++_index;break}else{throw error('Expected "," or "'+closeChar+'"')}}return items}function error(message,pos){if(pos===undefined){pos=_index}var start=_source.lastIndexOf("<",pos-1);var lastClose=_source.lastIndexOf(">",pos-1);start=lastClose>start?lastClose+1:start;var context=_source.slice(start,pos+10);var msg=message+" at pos "+pos+': "'+context+'"';return new ParserError(msg,pos,context)}function recover(){var opening=_source.indexOf("<",_index);var junk;if(opening===-1){junk={type:"JunkEntry",content:_source.slice(_index)};_index=_length;return junk}junk={type:"JunkEntry",content:_source.slice(_index,opening)};_index=opening;return junk}}Parser.Error=ParserError;function ParserError(message,pos,context){this.name="ParserError";this.message=message;this.pos=pos;this.context=context}ParserError.prototype=Object.create(Error.prototype);ParserError.prototype.constructor=ParserError;exports.Parser=Parser});define("l20n/compiler",function(require,exports){var EventEmitter=require("./events").EventEmitter;function Compiler(){this.compile=compile;this.setGlobals=setGlobals;this.addEventListener=addEvent;this.removeEventListener=removeEvent;var MAX_PLACEABLE_LENGTH=2500;var _emitter=new EventEmitter;var _globals=null;var _references={globals:{}};var _entryTypes={Entity:Entity,Macro:Macro};function compile(ast,env){if(!env){env={}}for(var i=0,entry;entry=ast.body[i];i++){var Constructor=_entryTypes[entry.type];if(Constructor){try{env[entry.id.name]=new Constructor(entry,env)}catch(e){requireCompilerError(e)}}}return env}function setGlobals(globals){_globals=globals;return true}function addEvent(type,listener){return _emitter.addEventListener(type,listener)}function removeEvent(type,listener){return _emitter.removeEventListener(type,listener)}function emit(Ctor,message,entry,source){var e=new Ctor(message,entry,source);_emitter.emit("error",e);return e}function Entity(node,env){this.id=node.id.name;this.env=env;this.local=node.local||false;this.index=null;this.attributes=null;this.publicAttributes=null;var i;if(node.index){this.index=[];for(i=0;i<node.index.length;i++){this.index.push(IndexExpression(node.index[i],this))}}if(node.attrs){this.attributes={};this.publicAttributes=[];for(i=0;i<node.attrs.length;i++){var attr=node.attrs[i];this.attributes[attr.key.name]=new Attribute(attr,this);if(!attr.local){this.publicAttributes.push(attr.key.name)}}}if(node.value&&node.value.type==="String"){this.value=node.value.content}else{this.value=LazyExpression(node.value,this,this.index)}}Entity.prototype.getString=function E_getString(ctxdata){try{var locals={__this__:this,__env__:this.env};return _resolve(this.value,locals,ctxdata)}catch(e){requireCompilerError(e);if(e instanceof ValueError){_emitter.emit("error",e)}throw e}};Entity.prototype.get=function E_get(ctxdata){_references.globals={};var entity={value:this.getString(ctxdata),attributes:{}};if(this.publicAttributes){entity.attributes={};for(var i=0,attr;attr=this.publicAttributes[i];i++){entity.attributes[attr]=this.attributes[attr].getString(ctxdata)}}entity.globals=_references.globals;return entity};function Attribute(node,entity){this.key=node.key.name;this.local=node.local||false;this.index=null;if(node.index){this.index=[];for(var i=0;i<node.index.length;i++){this.index.push(IndexExpression(node.index[i],this))}}if(node.value&&node.value.type==="String"){this.value=node.value.content}else{this.value=LazyExpression(node.value,entity,this.index)}this.entity=entity}Attribute.prototype.getString=function A_getString(ctxdata){try{var locals={__this__:this.entity,__env__:this.entity.env};return _resolve(this.value,locals,ctxdata)}catch(e){requireCompilerError(e);if(e instanceof ValueError){_emitter.emit("error",e)}throw e}};function Macro(node,env){this.id=node.id.name;this.env=env;this.local=node.local||false;this.expression=LazyExpression(node.expression,this);this.args=node.args}Macro.prototype._call=function M_call(args,ctxdata){var locals={__this__:this,__env__:this.env};if(this.args.length!==args.length){throw new RuntimeError(this.id+"() takes exactly "+this.args.length+" argument(s) ("+args.length+" given)")}for(var i=0;i<this.args.length;i++){locals[this.args[i].id.name]=args[i]}var final=this.expression(locals,ctxdata);locals=final[0];final=final[1];return[locals,_resolve(final,locals,ctxdata)]};var EXPRESSION_TYPES={Identifier:Identifier,ThisExpression:ThisExpression,VariableExpression:VariableExpression,GlobalsExpression:GlobalsExpression,Number:NumberLiteral,String:StringLiteral,Hash:HashLiteral,HashItem:Expression,ComplexString:ComplexString,UnaryExpression:UnaryExpression,BinaryExpression:BinaryExpression,LogicalExpression:LogicalExpression,ConditionalExpression:ConditionalExpression,CallExpression:CallExpression,PropertyExpression:PropertyExpression,AttributeExpression:AttributeExpression,ParenthesisExpression:ParenthesisExpression};function Expression(node,entry,index){if(!node){return null}if(!EXPRESSION_TYPES[node.type]){throw emit("CompilationError","Unknown expression type"+node.type)}if(index){index=index.slice()}return EXPRESSION_TYPES[node.type](node,entry,index)}function LazyExpression(node,entry,index){if(!node){return null}var expr;return function(locals,ctxdata,prop){if(!expr){expr=Expression(node,entry,index)}return expr(locals,ctxdata,prop)}}function _resolve(expr,locals,ctxdata){if(typeof expr==="string"||typeof expr==="boolean"||typeof expr==="number"||!expr){return expr}if(expr.value!==undefined){return _resolve(expr.value,locals,ctxdata)}if(typeof expr==="function"){var current=expr(locals,ctxdata);locals=current[0];current=current[1];return _resolve(current,locals,ctxdata)}if(expr.expression){throw new RuntimeError("Uncalled macro: "+expr.id)}throw new RuntimeError("Cannot resolve ctxdata or global of type "+typeof expr)}function Identifier(node){var name=node.name;return function identifier(locals){if(!locals.__env__.hasOwnProperty(name)){throw new RuntimeError("Reference to an unknown entry: "+name)}locals={__this__:locals.__env__[name],__env__:locals.__env__};return[locals,locals.__this__]}}function ThisExpression(){return function thisExpression(locals){return[locals,locals.__this__]}}function VariableExpression(node){var name=node.id.name;return function variableExpression(locals,ctxdata){if(locals.hasOwnProperty(name)){return locals[name]}if(!ctxdata||!ctxdata.hasOwnProperty(name)){throw new RuntimeError("Reference to an unknown variable: "+name)}return[locals,ctxdata[name]]}}function GlobalsExpression(node){var name=node.id.name;return function globalsExpression(locals){if(!_globals){throw new RuntimeError("No globals set (tried @"+name+")")}if(!_globals.hasOwnProperty(name)){throw new RuntimeError("Reference to an unknown global: "+name)}var value;try{value=_globals[name].get()}catch(e){throw new RuntimeError("Cannot evaluate global "+name)}_references.globals[name]=true;return[locals,value]}}function NumberLiteral(node){return function numberLiteral(locals){return[locals,node.value]}}function StringLiteral(node){return function stringLiteral(locals,ctxdata,key){if(key!==undefined){throw new RuntimeError("Cannot get property of a string: "+key)}return[locals,node.content]}}function ComplexString(node,entry){var content=[];for(var i=0;i<node.content.length;i++){content.push(Expression(node.content[i],entry))}return function(){var dirty=false;return function complexString(locals,ctxdata,key){if(key!==undefined){throw new RuntimeError("Cannot get property of a string: "+key)}if(dirty){throw new RuntimeError("Cyclic reference detected")}dirty=true;var parts=[];try{for(var i=0;i<content.length;i++){var part=_resolve(content[i],locals,ctxdata);if(typeof part!=="string"&&typeof part!=="number"){throw new RuntimeError("Placeables must be strings or "+"numbers")}if(part.length>MAX_PLACEABLE_LENGTH){throw new RuntimeError("Placeable has too many characters, "+"maximum allowed is "+MAX_PLACEABLE_LENGTH)}parts.push(part)}}catch(e){requireCompilerError(e);throw new ValueError(e.message,entry,node.source)}finally{dirty=false}return[locals,parts.join("")]}}()}function IndexExpression(node,entry){var expression=Expression(node,entry);return function(){var dirty=false;return function indexExpression(locals,ctxdata){if(dirty){throw new RuntimeError("Cyclic reference detected")}dirty=true;var retval;try{retval=_resolve(expression,locals,ctxdata)}catch(e){if(e instanceof IndexError){throw e}requireCompilerError(e);throw emit(IndexError,e.message,entry)}finally{dirty=false}return[locals,retval]}}()}function HashLiteral(node,entry,index){var content={};var defaultKey;var defaultIndex=index?index.shift():undefined;for(var i=0;i<node.content.length;i++){var elem=node.content[i];content[elem.key.name]=Expression(elem.value,entry,index);if(elem.default){defaultKey=elem.key.name}}return function hashLiteral(locals,ctxdata,prop){var keysToTry=[prop,defaultIndex,defaultKey];var keysTried=[];for(var i=0;i<keysToTry.length;i++){var key=_resolve(keysToTry[i],locals,ctxdata);if(key===undefined){continue}if(typeof key!=="string"){throw emit(IndexError,"Index must be a string",entry)}keysTried.push(key);if(content.hasOwnProperty(key)){return[locals,content[key]]}}var message;if(keysTried.length){message="Hash key lookup failed "+'(tried "'+keysTried.join('", "')+'").'}else{message="Hash key lookup failed."}throw emit(IndexError,message,entry)}}function UnaryOperator(token,entry){if(token==="-")return function negativeOperator(argument){if(typeof argument!=="number"){throw new RuntimeError("The unary - operator takes a number")}return-argument};if(token==="+")return function positiveOperator(argument){if(typeof argument!=="number"){throw new RuntimeError("The unary + operator takes a number")}return+argument};if(token==="!")return function notOperator(argument){if(typeof argument!=="boolean"){throw new RuntimeError("The ! operator takes a boolean")}return!argument};throw emit(CompilationError,"Unknown token: "+token,entry)}function BinaryOperator(token,entry){if(token==="==")return function equalOperator(left,right){if((typeof left!=="number"||typeof right!=="number")&&(typeof left!=="string"||typeof right!=="string")){throw new RuntimeError("The == operator takes two numbers or "+"two strings")}return left===right};if(token==="!=")return function notEqualOperator(left,right){if((typeof left!=="number"||typeof right!=="number")&&(typeof left!=="string"||typeof right!=="string")){throw new RuntimeError("The != operator takes two numbers or "+"two strings")}return left!==right};if(token==="<")return function lessThanOperator(left,right){if(typeof left!=="number"||typeof right!=="number"){throw new RuntimeError("The < operator takes two numbers")}return left<right};if(token==="<=")return function lessThanEqualOperator(left,right){if(typeof left!=="number"||typeof right!=="number"){throw new RuntimeError("The <= operator takes two numbers")}return left<=right};if(token===">")return function greaterThanOperator(left,right){if(typeof left!=="number"||typeof right!=="number"){throw new RuntimeError("The > operator takes two numbers")}return left>right};if(token===">="){return function greaterThanEqualOperator(left,right){if(typeof left!=="number"||typeof right!=="number"){throw new RuntimeError("The >= operator takes two numbers")}return left>=right}}if(token==="+")return function addOperator(left,right){if((typeof left!=="number"||typeof right!=="number")&&(typeof left!=="string"||typeof right!=="string")){throw new RuntimeError("The + operator takes two numbers or "+"two strings")}return left+right};if(token==="-")return function substractOperator(left,right){if(typeof left!=="number"||typeof right!=="number"){throw new RuntimeError("The - operator takes two numbers")}return left-right};if(token==="*")return function multiplyOperator(left,right){if(typeof left!=="number"||typeof right!=="number"){throw new RuntimeError("The * operator takes two numbers")}return left*right};if(token==="/")return function devideOperator(left,right){if(typeof left!=="number"||typeof right!=="number"){throw new RuntimeError("The / operator takes two numbers")}if(right===0){throw new RuntimeError("Division by zero not allowed.")}return left/right};if(token==="%")return function moduloOperator(left,right){if(typeof left!=="number"||typeof right!=="number"){throw new RuntimeError("The % operator takes two numbers")}if(right===0){throw new RuntimeError("Modulo zero not allowed.")}return left%right};throw emit(CompilationError,"Unknown token: "+token,entry)}function LogicalOperator(token,entry){if(token==="&&")return function andOperator(left,right){if(typeof left!=="boolean"||typeof right!=="boolean"){throw new RuntimeError("The && operator takes two booleans")}return left&&right};if(token==="||")return function orOperator(left,right){if(typeof left!=="boolean"||typeof right!=="boolean"){throw new RuntimeError("The || operator takes two booleans")}return left||right};throw emit(CompilationError,"Unknown token: "+token,entry)}function UnaryExpression(node,entry){var operator=UnaryOperator(node.operator.token,entry);var argument=Expression(node.argument,entry);return function unaryExpression(locals,ctxdata){return[locals,operator(_resolve(argument,locals,ctxdata))]}}function BinaryExpression(node,entry){var left=Expression(node.left,entry);var operator=BinaryOperator(node.operator.token,entry);var right=Expression(node.right,entry);return function binaryExpression(locals,ctxdata){return[locals,operator(_resolve(left,locals,ctxdata),_resolve(right,locals,ctxdata))]}}function LogicalExpression(node,entry){var left=Expression(node.left,entry);var operator=LogicalOperator(node.operator.token,entry);var right=Expression(node.right,entry);return function logicalExpression(locals,ctxdata){return[locals,operator(_resolve(left,locals,ctxdata),_resolve(right,locals,ctxdata))]}}function ConditionalExpression(node,entry){var test=Expression(node.test,entry);var consequent=Expression(node.consequent,entry);var alternate=Expression(node.alternate,entry);return function conditionalExpression(locals,ctxdata){var tested=_resolve(test,locals,ctxdata);if(typeof tested!=="boolean"){throw new RuntimeError("Conditional expressions must test a "+"boolean")}if(tested===true){return consequent(locals,ctxdata)}return alternate(locals,ctxdata)}}function CallExpression(node,entry){var callee=Expression(node.callee,entry);var args=[];for(var i=0;i<node.arguments.length;i++){args.push(Expression(node.arguments[i],entry))}return function callExpression(locals,ctxdata){var evaluated_args=[];for(var i=0;i<args.length;i++){evaluated_args.push(args[i](locals,ctxdata))}var macro=callee(locals,ctxdata);locals=macro[0];macro=macro[1];if(!macro.expression){throw new RuntimeError("Expected a macro, got a non-callable.")}return macro._call(evaluated_args,ctxdata)}}function PropertyExpression(node,entry){var expression=Expression(node.expression,entry);var property=node.computed?Expression(node.property,entry):node.property.name;return function propertyExpression(locals,ctxdata){var prop=_resolve(property,locals,ctxdata);if(typeof prop!=="string"){throw new RuntimeError("Property name must evaluate to a string: "+prop)}var parent=expression(locals,ctxdata);locals=parent[0];parent=parent[1];if(parent&&parent.value!==undefined){if(typeof parent.value!=="function"){throw new RuntimeError("Cannot get property of a "+typeof parent.value+": "+prop)}return parent.value(locals,ctxdata,prop)}if(typeof parent==="function"){return parent(locals,ctxdata,prop)}if(parent&&parent.expression){throw new RuntimeError("Cannot get property of a macro: "+prop)}if(typeof parent==="object"){if(parent===null){throw new RuntimeError("Cannot get property of a null: "+prop)}if(Array.isArray(parent)){throw new RuntimeError("Cannot get property of an array: "+prop)}if(!parent.hasOwnProperty(prop)){throw new RuntimeError(prop+" is not defined on the object.")}return[locals,parent[prop]]}throw new RuntimeError("Cannot get property of a "+typeof parent+": "+prop)}}function AttributeExpression(node,entry){var expression=Expression(node.expression,entry);var attribute=node.computed?Expression(node.attribute,entry):node.attribute.name;return function attributeExpression(locals,ctxdata){var attr=_resolve(attribute,locals,ctxdata);var entity=expression(locals,ctxdata);locals=entity[0];entity=entity[1];if(!entity.attributes){throw new RuntimeError("Cannot get attribute of a non-entity: "+attr)}if(!entity.attributes.hasOwnProperty(attr)){throw new RuntimeError(entity.id+" has no attribute "+attr)}return[locals,entity.attributes[attr]]}}function ParenthesisExpression(node,entry){return Expression(node.expression,entry)}}Compiler.Error=CompilerError;Compiler.CompilationError=CompilationError;Compiler.RuntimeError=RuntimeError;Compiler.ValueError=ValueError;Compiler.IndexError=IndexError;function CompilerError(message){this.name="CompilerError";this.message=message}CompilerError.prototype=Object.create(Error.prototype);CompilerError.prototype.constructor=CompilerError;function CompilationError(message,entry){CompilerError.call(this,message);this.name="CompilationError";this.entry=entry.id}CompilationError.prototype=Object.create(CompilerError.prototype);CompilationError.prototype.constructor=CompilationError;function RuntimeError(message){CompilerError.call(this,message);this.name="RuntimeError"}RuntimeError.prototype=Object.create(CompilerError.prototype);RuntimeError.prototype.constructor=RuntimeError;function ValueError(message,entry,source){RuntimeError.call(this,message);this.name="ValueError";this.entry=entry.id;this.source=source}ValueError.prototype=Object.create(RuntimeError.prototype);ValueError.prototype.constructor=ValueError;function IndexError(message,entry){RuntimeError.call(this,message);this.name="IndexError";this.entry=entry.id}IndexError.prototype=Object.create(RuntimeError.prototype);IndexError.prototype.constructor=IndexError;function requireCompilerError(e){if(!(e instanceof CompilerError)){throw e}}exports.Compiler=Compiler});define("l20n/retranslation",function(require,exports){"use strict";function RetranslationManager(){var _usage=[];var _counter={};var _callbacks=[];this.bindGet=bindGet;this.unbindGet=unbindGet;this.all=all;this.globals={};RetranslationManager._constructors.forEach(function(ctor){initGlobal.call(this,ctor)},this);function initGlobal(GlobalCtor){var global=new GlobalCtor;this.globals[global.id]=global;if(!global.activate){return}_counter[global.id]=0;global.addEventListener("change",function(id){for(var i=0;i<_usage.length;i++){if(_usage[i]&&_usage[i].globals.indexOf(id)!==-1){_usage[i].callback({global:global.id})}}})}function bindGet(get,isRebind){var i;var inCallbacks;for(i=0;i<_callbacks.length;i++){if(_callbacks[i].id===get.id){inCallbacks=true;break}}if(!inCallbacks){_callbacks.push(get)}else if(isRebind){_callbacks[i]=get}var bound;for(i=0;i<_usage.length;i++){if(_usage[i]&&_usage[i].id===get.id){bound=_usage[i];break}}var added;if(!bound){if(get.globals.length!==0){_usage.push(get);get.globals.forEach(function(id){if(!this.globals[id].activate){return}_counter[id]++;this.globals[id].activate()},this)}}else if(isRebind){bound.callback=get.callback;added=get.globals.filter(function(id){return this.globals[id].activate&&bound.globals.indexOf(id)===-1},this);added.forEach(function(id){_counter[id]++;this.globals[id].activate()},this);bound.globals=bound.globals.concat(added)}else if(get.globals.length===0){delete _usage[i]}else{added=get.globals.filter(function(id){return this.globals[id].activate&&bound.globals.indexOf(id)===-1},this);added.forEach(function(id){_counter[id]++;this.globals[id].activate()},this);var removed=bound.globals.filter(function(id){return this.globals[id].activate&&get.globals.indexOf(id)===-1},this);removed.forEach(function(id){_counter[id]--;if(_counter[id]===0){this.globals[id].deactivate()}},this);bound.globals=get.globals}}function unbindGet(id){var bound;var usagePos=-1;for(var i=0;i<_usage.length;i++){if(_usage[i]&&_usage[i].id===id){bound=_usage[i];usagePos=i;break}}if(bound){bound.globals.forEach(function(id){if(this.globals[id].activate){_counter[id]--;if(_counter[id]===0){this.globals[id].deactivate()}}},this);_usage.splice(usagePos,1);for(i=0;i<_callbacks.length;i++){if(_callbacks[i].id===id){_callbacks.splice(i,1);break}}}}function all(locales){for(var i=0;i<_callbacks.length;i++){_callbacks[i].callback({locales:locales})}}}RetranslationManager._constructors=[];RetranslationManager.registerGlobal=function(ctor){RetranslationManager._constructors.push(ctor)};RetranslationManager.deregisterGlobal=function(ctor){var pos=RetranslationManager._constructors.indexOf(ctor);if(pos!==-1){RetranslationManager._constructors.splice(pos,1)}};exports.RetranslationManager=RetranslationManager});define("l20n/platform/globals",function(require,exports){"use strict";var EventEmitter=require("../events").EventEmitter;var RetranslationManager=require("../retranslation").RetranslationManager;function Global(){this.id=null;this._emitter=new EventEmitter;this.value=null;this.isActive=false}Global.prototype._get=function _get(){throw new Error("Not implemented")};Global.prototype.get=function get(){if(!this.value||!this.isActive){this.value=this._get()}return this.value};Global.prototype.addEventListener=function(type,listener){if(type!=="change"){throw"Unknown event type"}this._emitter.addEventListener(type,listener)};function ScreenGlobal(){Global.call(this);this.id="screen";this._get=_get;this.activate=function activate(){if(!this.isActive){window.addEventListener("resize",onchange);this.isActive=true}};this.deactivate=function deactivate(){window.removeEventListener("resize",onchange);this.value=null;this.isActive=false};function _get(){return{width:{px:document.body.clientWidth}}}var self=this;function onchange(){self.value=_get();self._emitter.emit("change",self.id)}}ScreenGlobal.prototype=Object.create(Global.prototype);ScreenGlobal.prototype.constructor=ScreenGlobal;function OSGlobal(){Global.call(this);this.id="os";this.get=get;function get(){if(/^MacIntel/.test(navigator.platform)){return"mac"}if(/^Linux/.test(navigator.platform)){return"linux"}if(/^Win/.test(navigator.platform)){return"win"}return"unknown"}}OSGlobal.prototype=Object.create(Global.prototype);OSGlobal.prototype.constructor=OSGlobal;function HourGlobal(){Global.call(this);this.id="hour";this._get=_get;this.activate=function activate(){if(!this.isActive){var time=new Date;I=setTimeout(function(){onchange();I=setInterval(onchange,interval)},interval-time.getTime()%interval);this.isActive=true}};this.deactivate=function deactivate(){clearInterval(I);this.value=null;this.isActive=false};function _get(){var time=new Date;return time.getHours()}var self=this;var interval=60*60*1e3;var I=null;function onchange(){var time=new Date;if(time.getHours()!==self.value){self.value=time.getHours();self._emitter.emit("change",self.id)}}}HourGlobal.prototype=Object.create(Global.prototype);HourGlobal.prototype.constructor=HourGlobal;RetranslationManager.registerGlobal(ScreenGlobal);RetranslationManager.registerGlobal(OSGlobal);RetranslationManager.registerGlobal(HourGlobal);exports.Global=Global});define("l20n/platform/io",function(require,exports){"use strict";exports.load=function load(url,callback,sync){var xhr=new XMLHttpRequest;if(xhr.overrideMimeType){xhr.overrideMimeType("text/plain")}xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===200||xhr.status===0){callback(null,xhr.responseText)}else{var ex=new IOError("Not found: "+url);callback(ex)}}};xhr.open("GET",url,!sync);xhr.send("")};function IOError(message){this.name="IOError";this.message=message}IOError.prototype=Object.create(Error.prototype);IOError.prototype.constructor=IOError;exports.Error=IOError});define("l20n/intl",function(require,exports,module){"use strict";if(!String.prototype.startsWith){Object.defineProperty(String.prototype,"startsWith",{enumerable:false,configurable:false,writable:false,value:function(searchString,position){position=position||0;return this.indexOf(searchString,position)===position}})}var unicodeLocaleExtensionSequence="-u(-[a-z0-9]{2,8})+";var unicodeLocaleExtensionSequenceRE=new RegExp(unicodeLocaleExtensionSequence);var unicodeLocaleExtensionSequenceGlobalRE=new RegExp(unicodeLocaleExtensionSequence,"g");var langTagMappings={};var langSubtagMappings={};var extlangMappings={};var languageTagRE=function(){var ALPHA="[a-zA-Z]";var DIGIT="[0-9]";var alphanum="(?:"+ALPHA+"|"+DIGIT+")";var regular="(?:art-lojban|cel-gaulish|no-bok|no-nyn|zh-guoyu|zh-hakka|zh-min|zh-min-nan|zh-xiang)";var irregular="(?:en-GB-oed|i-ami|i-bnn|i-default|i-enochian|i-hak|i-klingon|i-lux|i-mingo|i-navajo|i-pwn|i-tao|i-tay|i-tsu|sgn-BE-FR|sgn-BE-NL|sgn-CH-DE)";var grandfathered="(?:"+irregular+"|"+regular+")";var privateuse="(?:x(?:-[a-z0-9]{1,8})+)";var singleton="(?:"+DIGIT+"|[A-WY-Za-wy-z])";var extension="(?:"+singleton+"(?:-"+alphanum+"{2,8})+)";var variant="(?:"+alphanum+"{5,8}|(?:"+DIGIT+alphanum+"{3}))";var region="(?:"+ALPHA+"{2}|"+DIGIT+"{3})";var script="(?:"+ALPHA+"{4})";var extlang="(?:"+ALPHA+"{3}(?:-"+ALPHA+"{3}){0,2})";var language="(?:"+ALPHA+"{2,3}(?:-"+extlang+")?|"+ALPHA+"{4}|"+ALPHA+"{5,8})";var langtag=language+"(?:-"+script+")?(?:-"+region+")?(?:-"+variant+")*(?:-"+extension+")*(?:-"+privateuse+")?";var languageTag="^(?:"+langtag+"|"+privateuse+"|"+grandfathered+")$";return new RegExp(languageTag,"i")}();var duplicateVariantRE=function(){var ALPHA="[a-zA-Z]";var DIGIT="[0-9]";var alphanum="(?:"+ALPHA+"|"+DIGIT+")";var variant="(?:"+alphanum+"{5,8}|(?:"+DIGIT+alphanum+"{3}))";var duplicateVariant="(?:"+alphanum+"{2,8}-)+"+"("+variant+")-"+"(?:"+alphanum+"{2,8}-)*"+"\\1"+"(?!"+alphanum+")";return new RegExp(duplicateVariant)}();var duplicateSingletonRE=function(){var ALPHA="[a-zA-Z]";var DIGIT="[0-9]";var alphanum="(?:"+ALPHA+"|"+DIGIT+")";var singleton="(?:"+DIGIT+"|[A-WY-Za-wy-z])";var duplicateSingleton="-("+singleton+")-"+"(?:"+alphanum+"+-)*"+"\\1"+"(?!"+alphanum+")";return new RegExp(duplicateSingleton)}();function IsStructurallyValidLanguageTag(locale){if(!languageTagRE.test(locale))return false;if(locale.startsWith("x-"))return true;var pos=locale.indexOf("-x-");if(pos!==-1)locale=locale.substring(0,pos);return!duplicateVariantRE.test(locale)&&!duplicateSingletonRE.test(locale)}function CanonicalizeLanguageTag(locale){locale=locale.toLowerCase();if(langTagMappings&&langTagMappings.hasOwnProperty(locale))return langTagMappings[locale];var subtags=locale.split("-");var i=0;while(i<subtags.length){var subtag=subtags[i];if(subtag.length===1&&(i>0||subtag==="x"))break;if(subtag.length===4){subtag=subtag[0].toUpperCase()+subtag.substring(1)}else if(i!==0&&subtag.length===2){subtag=subtag.toUpperCase()}if(langSubtagMappings.hasOwnProperty(subtag)){subtag=langSubtagMappings[subtag]}else if(extlangMappings.hasOwnProperty(subtag)){subtag=extlangMappings[subtag].preferred;if(i===1&&extlangMappings[subtag].prefix===subtags[0]){subtags.shift();i--}}subtags[i]=subtag;i++}var normal=subtags.slice(0,i).join("-");var extensions=[];while(i<subtags.length&&subtags[i]!=="x"){var extensionStart=i;i++;while(i<subtags.length&&subtags[i].length>1)i++;var extension=sybtags.slice(extensionStart,i).join("-");extensions.push(extension)}extensions.sort();var privateUse="";if(i<subtags.length)privateUse=subtags.slice(i).join("-");var canonical=normal;if(extensions.length>0)canonical+="-"+extensions.join("-");if(privateUse.length>0){if(canonical.length>0)canonical+="-"+privateUse;else canonical=privateUse}return canonical}function CanonicalizeLocaleList(locales){if(locales===undefined)return[];var seen=[];if(typeof locales==="string")locales=[locales];var O=locales;var len=O.length;var k=0;while(k<len){var kPresent=k in O;if(kPresent){var kValue=O[k];if(!(typeof kValue==="string"||typeof kValue==="object"))ThrowError(JSMSG_INVALID_LOCALES_ELEMENT);var tag=kValue;if(!IsStructurallyValidLanguageTag(tag))ThrowError(JSMSG_INVALID_LANGUAGE_TAG,tag);tag=CanonicalizeLanguageTag(tag);if(seen.indexOf(tag)===-1)seen.push(tag)}k++}return seen}function BestAvailableLocale(availableLocales,locale){var candidate=locale;while(true){if(availableLocales.indexOf(candidate)!==-1)return candidate;var pos=candidate.lastIndexOf("-");if(pos===-1)return undefined;if(pos>=2&&candidate[pos-2]==="-")pos-=2;candidate=candidate.substring(0,pos)}}function LookupAvailableLocales(availableLocales,requestedLocales){var len=requestedLocales.length;var subset=[];var k=0;while(k<len){var locale=requestedLocales[k];var noExtensionsLocale=locale.replace(unicodeLocaleExtensionSequenceGlobalRE,"");var availableLocale=BestAvailableLocale(availableLocales,noExtensionsLocale);if(availableLocale!==undefined)subset.push(availableLocale);k++}return subset.slice(0)}function PrioritizeLocales(availableLocales,requestedLocales,defaultLocale){availableLocales=CanonicalizeLocaleList(availableLocales);requestedLocales=CanonicalizeLocaleList(requestedLocales);var result=LookupAvailableLocales(availableLocales,requestedLocales);if(!defaultLocale){return result}defaultLocale=CanonicalizeLanguageTag(defaultLocale);if(result.indexOf(defaultLocale)===-1){result.push(defaultLocale)}return result}exports.Intl={prioritizeLocales:PrioritizeLocales}});window.L20n=require("l20n");require("l20n/html")})(window);
